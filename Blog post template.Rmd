---
title: "Blog post template"
author: "Cynthia Aguilar, Jennifer Huang, Chloe Nance, Kate Seeger"
date: "3/5/2021"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    df_print: paged
    code_download: true
    theme: journal
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE)
```

```{r, echo = FALSE}
library(tidyverse)    
library(lubridate)    
library(openintro)     
library(maps)          
library(ggmap)         
library(gplots)       
library(RColorBrewer)  
library(sf)            
library(leaflet)       
library(ggthemes)      
library(plotly)        
library(gganimate)    
library(transformr)    
library(gifski)        
library(shiny)         
library(ggimage)
library(tidytuesdayR)
library(patchwork)
theme_set(theme_minimal())
```


```{r, echo=FALSE}
# College Tuition Data
tuition_cost <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/tuition_cost.csv')
diversity_school <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/diversity_school.csv')

#tuition_income <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/tuition_income.csv') 
#salary_potential <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/salary_potential.csv')
#historical_tuition <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/historical_tuition.csv')


# Wealth and Income Over Time
student_debt <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/student_debt.csv')
retirement <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/retirement.csv')
home_owner <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/home_owner.csv')
race_wealth <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/race_wealth.csv')
income_time <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/income_time.csv')
income_limits <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/income_limits.csv')

#lifetime_earn <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/lifetime_earn.csv')
#income_aggregate <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/income_aggregate.csv')
#income_distribution <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/income_distribution.csv')
#income_mean <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/income_mean.csv')
```


## Introduction
In 2017, the Urban Institute released data regarding wealth inequality in the United States. Their data delineated the increase in wealth inequality from 1986 to 2016. Across factors such as student loan debt and homeownership the wealth gap between Black and Hispanic families when compared to White families had bettered little over the years. This project incorporates historical income tables provided by the U.S Census Bureau and Tuitiontacker.org to further explore these disparities in the United States.   



## 1) Map of In and Out-of-state College Tuition

```{r, echo = FALSE}
states_map <- map_data("state")

state_center <- tibble(state = str_to_lower(state.name),
                       long = state.center$x,
                       lat = state.center$y)

tuition_cost %>%
  mutate(state = str_to_lower(state)) %>%
  group_by(state) %>% 
  summarise(in_state_avg = mean(in_state_total)) %>%
  left_join(state_center, by = "state") %>% 
  filter(state != c("alaska")) %>% 
  ggplot() +
  geom_map(map = states_map,
           aes(map_id = state,
               fill = in_state_avg)) +
  geom_label(aes(x = long, 
                 y = lat,
                 label = paste("$", round(in_state_avg/1000),"K", sep = "")),
             fill = "black", 
             color = "white", 
             size = 2.5) + 
  expand_limits(x = states_map$long, y = states_map$lat) + 
  scale_fill_viridis_c(option = "inferno", labels=scales::dollar_format()) +
  labs(title = "Average In State Tuition per State",
       caption = "Author: Chloe Nance",
       fill = "Average Cost") +
  theme_map() +
  theme(plot.title = element_text(face = "bold", hjust = .5, size = 15),
        plot.caption = element_text(face = "bold", size = 9),
        legend.title = element_text(face = "bold"))
```



```{r,  echo = FALSE}
states_map <- map_data("state")
  
state_center <- tibble(state = str_to_lower(state.name),
                       long = state.center$x,
                       lat = state.center$y)
  
tuition_cost %>%
  mutate(state = str_to_lower(state)) %>%
  group_by(state) %>% 
  summarise(out_state_avg = mean(out_of_state_total)) %>% 
  left_join(state_center, by = "state") %>% 
  filter(state != c("alaska")) %>% 
  ggplot() +
  geom_map(map = states_map,
           aes(map_id = state,
              fill = out_state_avg)) +
  geom_label(aes(x = long, 
                 y = lat, 
                 label = paste("$", round(out_state_avg/1000), "K", sep = "")), 
             fill = "black", 
             color = "white", 
             size = 2.5) +
  expand_limits(x = states_map$long, y = states_map$lat) + 
  scale_fill_viridis_c(option = "inferno",labels=scales::dollar_format()) +
  labs(title = "Average Out of State Tuition per State",
       caption = "Author: Chloe Nance",
       fill = "Average Cost") +
  theme_map() +
  theme(plot.title = element_text(face = "bold", hjust = .5, size = 15),
        plot.caption = element_text(face = "bold", size = 9),
        legend.title = element_text(face = "bold"))
```



```{r, echo = FALSE}
states_map <- map_data("state")

options(scipen=10000)

diversity_school %>%
  mutate(state = str_to_lower(state)) %>% 
  group_by(state) %>% 
  filter(category %in% c("Black", "White", "Hispanic", "Total Minority")) %>% 
  ggplot() +
  geom_map(map = states_map,
           aes(map_id = state,
               fill = enrollment)) +
  expand_limits(x = states_map$long, y = states_map$lat) + 
  scale_fill_viridis_c(option = "inferno") +
  labs(title = "Diversity enrollment in US colleges",
       caption = "Author: Chloe Nance",
       fill = "Enrollment") +
  facet_wrap(~category) +
  theme_map() +
  theme(plot.title = element_text(face = "bold", hjust = .5, size = 15),
        plot.caption = element_text(face = "bold", size = 9),
        legend.title = element_text(face = "bold"),
        legend.box.background = element_rect(),
        legend.box.margin = margin(6, 6, 6, 6),
        legend.position = "right")
```





## 2) Student loan debt and Average enrollment of students based on racial group

```{r, echo = FALSE}
debtplot <- student_debt %>%
  ggplot(aes(x = year,
             y = loan_debt_pct, 
             fill = race)) + 
  geom_area(alpha = 0.8) +
  labs(title = "Percentage of student loan debt by racial groups",
       x= "",
       y ="") + 
  theme_minimal() +
  theme(legend.position = "none") +
  facet_wrap(~ race) + 
  scale_y_continuous(labels=scales::percent_format()) +
  scale_fill_manual(values = c("#9370DB","#6495ED", "#40E0D0")) + 
  theme(plot.title = element_text(face = "bold", hjust = .5, size = 15),
        plot.caption = element_text(face = "bold", size = 9),
        legend.title = element_text(face = "bold"))

  
compplot <- diversity_school %>%
  filter(category %in% c("Black", 
                         "Hispanic", 
                         "White")) %>%
  group_by(name,
           category) %>%
  summarize(percent = enrollment/total_enrollment) %>%
  ggplot(aes(x = category,
             y = percent, 
             fill = category)) + 
  geom_boxplot() + 
  labs(title = "Average proportion of student enrollment by racial groups",
       x = "",
       y= "",
       caption = "Author: Kate Seeger") + 
  theme_minimal() +
  theme(legend.position = "none") +
  scale_fill_manual(values = c("#9370DB","#6495ED", "#40E0D0")) + 
  theme(plot.title = element_text(face = "bold", hjust = .5, size = 15),
        plot.caption = element_text(face = "bold", size = 9),
        legend.title = element_text(face = "bold"))


debtplot/compplot
```



## 3) Income limit and quintile graph based on racial group

```{r, echo = FALSE}
income_limits %>%  
  left_join(income_time, by =c("year")) %>% 
  filter(race %in% c("White Alone", "Black Alone", "Hispanic")) %>% 
  mutate(ordered = fct_reorder(income_quintile,
                               income_dollars,
                               .desc = FALSE)) %>% 
  ggplot() +
  geom_boxplot(aes(x = ordered,
             y = income_dollars,
             fill = race)) + 
  scale_y_continuous(limits = c(0,200000), expand = c(0, 0),labels=scales::dollar_format()) + 
  labs(title = "Income limits based on racial groups",
       x = "",
       y = "",
       fill = "",
       caption = "Author: Jennifer Huang") + 
  scale_fill_manual(values = c("#9370DB","#6495ED", "#40E0D0")) + 
  theme(plot.title = element_text(face = "bold", hjust = .5, size = 15),
        plot.caption = element_text(face = "bold", size = 9),
        legend.title = element_text(face = "bold"))
```




## 4) Average Family Liquid Retirement Savings from 1986-2016

```{r, echo=FALSE}
race_wealth %>%   
  filter(year >= "1989", race !="Non-White",type=="Median") %>% 
  left_join(retirement, by =c("race","year")) %>% 
  ggplot(aes(x= year,
             y= retirement,
             fill=race))+
  geom_histogram(stat = "identity")+
  geom_line(aes(y=wealth_family))+
  scale_x_continuous(limits = c(1989,2017), expand = c(0, 0)) +
  scale_y_continuous(limits = c(0,200000), expand = c(0, 0),labels=scales::dollar_format())+
  scale_fill_manual(values = c("#6941e1","#4169e1", "#41b9e1"))+
  labs(title = "Average Family Liquid Retirement Savings from 1986-2016",
       subtitle = "Line represents median family wealth",
       caption = "Author: Cynthia Aguilar",
       x="",
       y="") +
  theme_minimal() +
  theme(plot.title.position = "plot",
        legend.position = "none") +
  facet_wrap(vars(race)) + 
  theme(plot.title = element_text(face = "bold", hjust = .5, size = 15),
        plot.subtitle = element_text(hjust = .5, size = 9),
        plot.caption = element_text(face = "bold", size = 9),
        legend.title = element_text(face = "bold"))
```




## 5) Home ownership by racial group

```{r, echo = FALSE}
home_owner %>%
  ggplot(aes(x = year,
             y = home_owner_pct,
             color = race)) +
  geom_line() + 
  theme_minimal() + 
  labs(title = "Homeownership by race", 
       x = "",
       y = "",
       color = "",
       caption = "Author: Kate Seeger") +
  scale_y_continuous(labels=scales::percent_format()) +
  scale_color_manual(values = c("#9370DB","#6495ED", "#40E0D0")) + 
  theme(plot.title = element_text(face = "bold", hjust = .5, size = 15),
        plot.caption = element_text(face = "bold", size = 9),
        legend.title = element_text(face = "bold"))
```



## Conclusion
Black and Hispanic people’s varied experiences in double jeopardy is only a tip of the iceberg to the ingrained racism and inequality in the US. The data presented in this blog post does not account for individual differences in socioeconomic status, educational background, neighborhood environment, as well as other racial groups and minority groups. Despite that the analyses set forth in this blog post should be taken with a grain of salt, the overall trend inferred from this data set reflects the present day situation. 
